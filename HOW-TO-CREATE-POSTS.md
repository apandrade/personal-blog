# How to Create New Blog Posts

This guide explains step-by-step how to add new posts to your personal blog.

## üìã Table of Contents

1. [Overview](#overview)
2. [Current Method (Mock Database)](#current-method-mock-database)
3. [Recommended Method (Real Database)](#recommended-method-real-database)
4. [Post Structure](#post-structure)
5. [Practical Examples](#practical-examples)

## üîç Overview

Currently, the blog is configured with **mock** data automatically generated by Faker.js. This means posts are dynamically created every time you start the server and are not persisted in a real database.

To add real and permanent posts, you need to **implement a database service**.

## üé≠ Current Method (Mock Database)

### How It Works

The blog uses the `src/services/mock-database.service.ts` file which generates fake posts using Faker.js.

### Adding Posts Manually to Mock

To manually add posts to the mock service:

1. **Open the file**: `src/services/mock-database.service.ts`

2. **Locate the method** `generatePosts()` (line ~38)

3. **Add your posts** before automatic generation:

```typescript
private generatePosts(count: number): Post[] {
  const posts: Post[] = [];
  
  // ‚ú® ADD YOUR POSTS MANUALLY HERE:
  posts.push({
    id: 'my-first-post-id',
    title: 'My First Post',
    slug: 'my-first-post',
    excerpt: 'A brief description of my post that will appear in cards.',
    content: `## Introduction

This is my post content in Markdown.

You can add paragraphs, lists, and much more.

## Section 2

More content here...`,
    coverImage: 'https://picsum.photos/1200/630',
    publishedAt: new Date('2026-01-22'),
    authorId: this.author.id,
    tags: ['tutorial', 'blog', 'astro'],
  });

  // Faker posts continue to be generated normally
  for (let i = 0; i < count; i++) {
    // ... existing code
  }
  
  return posts.sort((a, b) => b.publishedAt.getTime() - a.publishedAt.getTime());
}
```

4. **Restart the server** to see your changes:

```bash
npm run dev
```

### ‚ö†Ô∏è Mock Method Limitations

- Posts are not persisted
- Every time you restart the server, data is regenerated
- Not suitable for production
- Difficult to manage many posts

## üóÑÔ∏è Recommended Method (Real Database)

For a production blog, you should implement a real database. The project is already prepared for this with an interface architecture.

### Database Options

1. **Prisma + PostgreSQL** (Recommended)
2. **MongoDB**
3. **Supabase**
4. **Firebase/Firestore**
5. **Any SQL/NoSQL database**

### Step-by-Step: Implementing with Prisma

#### 1. Install Dependencies

```bash
npm install prisma @prisma/client
npm install -D prisma
```

#### 2. Initialize Prisma

```bash
npx prisma init
```

#### 3. Configure Schema

Edit `prisma/schema.prisma`:

```prisma
datasource db {
  provider = "postgresql"  // ou "mysql", "sqlite", etc.
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Author {
  id      String  @id @default(uuid())
  name    String
  bio     String
  avatar  String
  email   String  @unique
  twitter String?
  linkedin String?
  github  String?
  posts   Post[]
}

model Post {
  id          String   @id @default(uuid())
  title       String
  slug        String   @unique
  excerpt     String
  content     String
  coverImage  String
  publishedAt DateTime
  authorId    String
  author      Author   @relation(fields: [authorId], references: [id])
  tags        String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

#### 4. Create Prisma Service

Create the file `src/services/prisma-database.service.ts`:

```typescript
import { PrismaClient } from '@prisma/client';
import type { DatabaseService, PaginatedPosts } from './database.interface';
import type { Author, Post, PostWithAuthor, PostFilters } from '../types';

export class PrismaDatabaseService implements DatabaseService {
  private prisma: PrismaClient;

  constructor(connectionString?: string) {
    this.prisma = new PrismaClient({
      datasources: {
        db: {
          url: connectionString || process.env.DATABASE_URL,
        },
      },
    });
  }

  async getAuthor(): Promise<Author> {
    const author = await this.prisma.author.findFirst();
    if (!author) throw new Error('Author not found');
    
    return {
      id: author.id,
      name: author.name,
      bio: author.bio,
      avatar: author.avatar,
      email: author.email,
      social: {
        twitter: author.twitter || undefined,
        linkedin: author.linkedin || undefined,
        github: author.github || undefined,
      },
    };
  }

  async getPosts(filters?: PostFilters): Promise<PaginatedPosts> {
    const page = filters?.page || 1;
    const perPage = filters?.perPage || 10;
    const skip = (page - 1) * perPage;

    const where: any = {};

    if (filters?.search) {
      where.OR = [
        { title: { contains: filters.search, mode: 'insensitive' } },
        { excerpt: { contains: filters.search, mode: 'insensitive' } },
      ];
    }

    if (filters?.year) {
      where.publishedAt = {
        gte: new Date(`${filters.year}-01-01`),
        lt: new Date(`${filters.year + 1}-01-01`),
      };
    }

    const [posts, total] = await Promise.all([
      this.prisma.post.findMany({
        where,
        include: { author: true },
        orderBy: { publishedAt: filters?.sortOrder || 'desc' },
        skip,
        take: perPage,
      }),
      this.prisma.post.count({ where }),
    ]);

    return {
      posts: posts.map(this.mapPostWithAuthor),
      total,
      page,
      perPage,
      totalPages: Math.ceil(total / perPage),
    };
  }

  async getPostBySlug(slug: string): Promise<PostWithAuthor | null> {
    const post = await this.prisma.post.findUnique({
      where: { slug },
      include: { author: true },
    });

    return post ? this.mapPostWithAuthor(post) : null;
  }

  async getRecentPosts(limit: number): Promise<PostWithAuthor[]> {
    const posts = await this.prisma.post.findMany({
      include: { author: true },
      orderBy: { publishedAt: 'desc' },
      take: limit,
    });

    return posts.map(this.mapPostWithAuthor);
  }

  async getAvailableDates(): Promise<{ year: number; month: number }[]> {
    const posts = await this.prisma.post.findMany({
      select: { publishedAt: true },
      orderBy: { publishedAt: 'desc' },
    });

    const dates = posts.map(p => ({
      year: p.publishedAt.getFullYear(),
      month: p.publishedAt.getMonth(),
    }));

    // Remove duplicatas
    return Array.from(
      new Set(dates.map(d => `${d.year}-${d.month}`))
    ).map(d => {
      const [year, month] = d.split('-');
      return { year: parseInt(year), month: parseInt(month) };
    });
  }

  async getPageContent(pageId: string): Promise<any> {
    // Implementar conforme necess√°rio
    return null;
  }

  private mapPostWithAuthor(post: any): PostWithAuthor {
    return {
      id: post.id,
      title: post.title,
      slug: post.slug,
      excerpt: post.excerpt,
      content: post.content,
      coverImage: post.coverImage,
      publishedAt: post.publishedAt,
      authorId: post.authorId,
      tags: post.tags,
      author: {
        id: post.author.id,
        name: post.author.name,
        bio: post.author.bio,
        avatar: post.author.avatar,
        email: post.author.email,
        social: {
          twitter: post.author.twitter || undefined,
          linkedin: post.author.linkedin || undefined,
          github: post.author.github || undefined,
        },
      },
    };
  }
}
```

#### 5. Update Configuration

Edit `src/lib/data.ts`:

```typescript
import { PrismaDatabaseService } from '../services/prisma-database.service';
import type { DatabaseService } from '../services/database.interface';

export const db: DatabaseService = new PrismaDatabaseService();
```

#### 6. Configure Environment Variables

Create `.env` in the project root:

```env
DATABASE_URL="postgresql://user:password@localhost:5432/myblog"
```

#### 7. Run Migrations

```bash
npx prisma migrate dev --name init
```

#### 8. Create First Author

Create a script `scripts/seed.ts`:

```typescript
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  // Create author
  const author = await prisma.author.create({
    data: {
      name: 'Your Name',
      bio: 'Your bio here',
      avatar: 'https://avatars.githubusercontent.com/u/your-user',
      email: 'your@email.com',
      twitter: 'your_twitter',
      linkedin: 'your-linkedin',
      github: 'your-github',
    },
  });

  console.log('‚úÖ Author created:', author);
}

main()
  .catch(console.error)
  .finally(() => prisma.$disconnect());
```

Run:

```bash
npx tsx scripts/seed.ts
```

### üìù Create New Post in Database

#### Option 1: Via Script

Create `scripts/create-post.ts`:

```typescript
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function createPost() {
  // Find the author
  const author = await prisma.author.findFirst();
  
  if (!author) {
    throw new Error('No author found. Run seed first.');
  }

  const post = await prisma.post.create({
    data: {
      title: 'How to Create a Blog with Astro',
      slug: 'how-to-create-blog-with-astro',
      excerpt: 'Learn how to create a modern and performant blog using Astro.js, with support for Markdown and reusable components.',
      content: `## Introduction

Astro is a modern framework for building fast and optimized websites.

## Why Astro?

- Zero JavaScript by default
- Components from any framework
- Automatic image optimization
- SEO friendly

## Getting Started

To create your blog with Astro...`,
      coverImage: 'https://picsum.photos/1200/630',
      publishedAt: new Date(),
      authorId: author.id,
      tags: ['astro', 'tutorial', 'web'],
    },
  });

  console.log('‚úÖ Post created:', post);
}

createPost()
  .catch(console.error)
  .finally(() => prisma.$disconnect());
```

Run:

```bash
npx tsx scripts/create-post.ts
```

#### Option 2: Via Prisma Studio (Visual Interface)

```bash
npx prisma studio
```

This will open a web interface where you can:
- View all posts
- Create new posts
- Edit existing posts
- Delete posts

#### Option 3: Via API/Admin Panel

You can create an API route in Astro to manage posts:

Create `src/pages/api/posts.ts`:

```typescript
import type { APIRoute } from 'astro';
import { db } from '../../lib/data';

export const POST: APIRoute = async ({ request }) => {
  try {
    const data = await request.json();
    
    // Validate data
    if (!data.title || !data.slug || !data.content) {
      return new Response(JSON.stringify({ error: 'Required fields missing' }), {
        status: 400,
      });
    }

    // Create post (implement createPost in your service)
    // const post = await db.createPost(data);
    
    return new Response(JSON.stringify({ success: true }), {
      status: 201,
    });
  } catch (error) {
    return new Response(JSON.stringify({ error: 'Error creating post' }), {
      status: 500,
    });
  }
};
```

## üì¶ Post Structure

Every post must contain the following fields:

```typescript
{
  id: string,              // Unique UUID
  title: string,           // Post title
  slug: string,            // URL-friendly slug (e.g., "my-first-post")
  excerpt: string,         // Short summary/description
  content: string,         // Full content in Markdown
  coverImage: string,      // Cover image URL
  publishedAt: Date,       // Publication date
  authorId: string,        // Author ID
  tags: string[],          // Array of tags (e.g., ['tutorial', 'astro'])
}
```

### Content Formatting (Markdown)

The `content` field accepts Markdown:

```markdown
## Section Title

Paragraph with normal text.

### Subtitle

- List item 1
- List item 2

**Bold text** and *italic*.

[Link to another site](https://example.com)

```code
Code blocks also work
```
```

## üé® Practical Examples

### Example 1: Technical Post

```typescript
{
  title: 'Understanding TypeScript Generics',
  slug: 'understanding-typescript-generics',
  excerpt: 'Learn how to use Generics in TypeScript to create more reusable and type-safe code.',
  content: `## What are Generics?

Generics allow you to create reusable components...

## Practical Example

\`\`\`typescript
function identity<T>(arg: T): T {
  return arg;
}
\`\`\``,
  coverImage: 'https://images.unsplash.com/photo-1516116216624-53e697fedbea',
  publishedAt: new Date('2026-01-22'),
  tags: ['typescript', 'programming', 'tutorial'],
}
```

### Example 2: Personal Post

```typescript
{
  title: 'My Journey as a Developer',
  slug: 'my-journey-as-developer',
  excerpt: 'I share my experience and learnings over the last 5 years working with web development.',
  content: `## How It All Started

5 years ago, I knew nothing about programming...

## Challenges Faced

The biggest challenge was...`,
  coverImage: 'https://images.unsplash.com/photo-1522071820081-009f0129c71c',
  publishedAt: new Date('2026-01-20'),
  tags: ['career', 'personal', 'development'],
}
```

## üîß Useful Commands

```bash
# Development
npm run dev                    # Start development server

# Build
npm run build                  # Generate production build
npm run preview                # Preview build locally

# Prisma (if implemented)
npx prisma studio              # Open visual database interface
npx prisma migrate dev         # Create new migration
npx prisma db push             # Push schema to database
npx prisma generate            # Generate Prisma Client
```

## üöÄ Next Steps

1. **Development**: Use the mock method for testing and development
2. **Production**: Implement a real database (Prisma recommended)
3. **CMS**: Consider adding a CMS like Sanity or Strapi
4. **Admin**: Create an admin interface to manage posts
5. **API**: Implement API routes to create/edit posts

## üìö Additional Resources

- [Astro Documentation](https://docs.astro.build)
- [Prisma Docs](https://www.prisma.io/docs)
- [Markdown Guide](https://www.markdownguide.org)
- [TypeScript Handbook](https://www.typescriptlang.org/docs)

## ‚ùì Frequently Asked Questions

### How do I change the order of posts?

Posts are sorted by `publishedAt` (publication date). To change the order, modify the dates.

### Can I use local images?

Yes! Place images in the `public/images/` folder and use relative URLs:
```typescript
coverImage: '/images/my-image.jpg'
```

### How do I add more fields to posts?

1. Update the `Post` interface in `src/types/index.ts`
2. Update the Prisma schema (if using)
3. Update components that display posts

### Does content support HTML?

Yes, Markdown can contain embedded HTML, but it's recommended to use Markdown whenever possible.

---

**Questions?** Check the [complete documentation](DOCUMENTATION.md) or open an issue in the repository.
